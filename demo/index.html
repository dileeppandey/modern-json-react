<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>modern-json-react ‚Äî Interactive Demo</title>
  <link rel="stylesheet" href="../dist/styles.css" />
  <style>
    :root {
      --bg: #f8f9fa;
      --surface: #ffffff;
      --text: #1e1e1e;
      --text-muted: #666;
      --border: #e0e0e0;
      --primary: #0066cc;
      --font-mono: 'SF Mono', 'Cascadia Code', 'Fira Code', 'JetBrains Mono', Consolas, monospace;
    }

    [data-theme="dark"] {
      --bg: #121212;
      --surface: #1e1e1e;
      --text: #d4d4d4;
      --text-muted: #999;
      --border: #3c3c3c;
      --primary: #4da6ff;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
    }

    .demo-app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    .header h1 { font-size: 1.5rem; font-weight: 600; }
    .header h1 span { color: var(--primary); }

    .controls { display: flex; gap: 8px; align-items: center; }

    .btn {
      padding: 6px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--surface);
      color: var(--text);
      cursor: pointer;
      font-size: 13px;
      transition: all 0.15s;
    }
    .btn:hover { border-color: var(--primary); color: var(--primary); }

    /* Responsive demo controls */
    .responsive-controls {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 16px;
      padding: 12px 16px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      flex-wrap: wrap;
    }

    .responsive-controls label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .responsive-controls .size-slider {
      flex: 1;
      min-width: 120px;
      accent-color: var(--primary);
    }

    .responsive-controls .size-label {
      font-family: var(--font-mono);
      font-size: 12px;
      color: var(--primary);
      min-width: 50px;
    }

    .responsive-controls .preset-btn {
      padding: 3px 10px;
      border: 1px solid var(--border);
      border-radius: 4px;
      background: transparent;
      color: var(--text);
      cursor: pointer;
      font-size: 12px;
    }
    .responsive-controls .preset-btn:hover { border-color: var(--primary); color: var(--primary); }
    .responsive-controls .preset-btn--active { background: var(--primary); color: white; border-color: var(--primary); }

    .editor-wrapper {
      margin: 0 auto;
      transition: width 0.3s ease;
    }

    /* Schema panel */
    .schema-panel {
      margin-top: 24px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }

    .schema-panel summary {
      padding: 12px 16px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
    }

    .schema-textarea {
      width: 100%;
      height: 150px;
      padding: 12px;
      border: none;
      border-top: 1px solid var(--border);
      font-family: var(--font-mono);
      font-size: 13px;
      background: var(--surface);
      color: var(--text);
      resize: vertical;
      outline: none;
    }

    /* Validation errors display */
    .validation-panel {
      margin-top: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      background: var(--surface);
    }

    .validation-panel summary {
      padding: 8px 16px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
    }

    .validation-item {
      padding: 4px 16px;
      font-size: 12px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 8px;
    }

    .validation-item .v-path {
      color: var(--primary);
      font-family: var(--font-mono);
    }

    .validation-item .v-msg {
      color: var(--text-muted);
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 200px;
      color: var(--text-muted);
      font-size: 14px;
    }

    @media (max-width: 768px) {
      .demo-app { padding: 12px; }
      .header h1 { font-size: 1.1rem; }
    }

    @media (max-width: 480px) {
      .demo-app { padding: 8px; }
      .header { flex-direction: column; gap: 8px; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div id="app"><div class="demo-app"><div class="loading">Loading component...</div></div></div>

  <!-- Import map: resolve bare specifiers used by dist/index.mjs -->
  <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.3.1",
        "react-dom": "https://esm.sh/react-dom@18.3.1",
        "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
        "react/jsx-runtime": "https://esm.sh/react@18.3.1/jsx-runtime",
        "htm": "https://esm.sh/htm@3.1.1"
      }
    }
  </script>

  <script type="module">
    import React, { useState, useCallback, useMemo, useEffect } from 'react';
    import { createRoot } from 'react-dom/client';
    import htm from 'htm';
    import { JsonEditor } from '../dist/index.mjs';

    // htm: tagged template JSX alternative ‚Äî no build step needed
    const html = htm.bind(React.createElement);

    const SAMPLE_JSON = {
      "name": "modern-json-react",
      "version": "1.0.0",
      "description": "A production-grade JSON editor for React",
      "author": {
        "name": "Developer",
        "email": "dev@example.com",
        "url": "https://example.com"
      },
      "features": [
        "Syntax highlighting",
        "Tree view editing",
        "JSON Schema validation",
        "Undo/Redo",
        "Search & filter",
        "Dark mode"
      ],
      "config": {
        "maxSize": 10485760,
        "indentation": 2,
        "theme": "auto",
        "validation": {
          "enabled": true,
          "debounceMs": 300,
          "strict": false
        }
      },
      "stats": {
        "downloads": 15432,
        "stars": 892,
        "openIssues": 7
      },
      "isPublished": true,
      "deprecated": false,
      "license": "MIT"
    };

    const SAMPLE_SCHEMA = {
      "type": "object",
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "version": { "type": "string", "pattern": "^\\d+\\.\\d+\\.\\d+$" },
        "description": { "type": "string" },
        "author": {
          "type": "object",
          "properties": {
            "name": { "type": "string" },
            "email": { "type": "string" }
          },
          "required": ["name"]
        },
        "features": { "type": "array", "items": { "type": "string" }, "minItems": 1 },
        "stats": {
          "type": "object",
          "properties": {
            "downloads": { "type": "number", "minimum": 0 },
            "stars": { "type": "number", "minimum": 0 },
            "openIssues": { "type": "number", "minimum": 0 }
          }
        },
        "isPublished": { "type": "boolean" },
        "license": { "type": "string", "enum": ["MIT", "Apache-2.0", "GPL-3.0", "BSD-3-Clause"] }
      },
      "required": ["name", "version"]
    };

    const PRESETS = [
      { label: 'Mobile', width: 360 },
      { label: 'Tablet', width: 768 },
      { label: 'Desktop', width: 100, isPercent: true },
    ];

    function App() {
      const [theme, setTheme] = useState('light');
      const [mode, setMode] = useState('code');
      const [containerWidth, setContainerWidth] = useState(100);
      const [schema, setSchema] = useState(JSON.stringify(SAMPLE_SCHEMA, null, 2));
      const [validationErrors, setValidationErrors] = useState([]);
      const [jsonValue, setJsonValue] = useState(SAMPLE_JSON);

      const parsedSchema = useMemo(() => {
        try { return JSON.parse(schema); }
        catch { return undefined; }
      }, [schema]);

      useEffect(() => {
        document.documentElement.setAttribute('data-theme', theme);
      }, [theme]);

      const handleChange = useCallback((value, rawText) => {
        setJsonValue(value);
      }, []);

      const handleValidate = useCallback((errors) => {
        setValidationErrors(errors);
      }, []);

      const widthStyle = containerWidth > 100 ? `${containerWidth}px` : '100%';
      const sliderValue = containerWidth <= 100 ? 1200 : containerWidth;
      const sizeLabel = containerWidth > 100 ? `${containerWidth}px` : '100%';

      return html`
        <div class="demo-app">
          <div class="header">
            <h1><span>modern-json-react</span> ‚Äî Interactive Demo</h1>
            <div class="controls">
              <button class="btn" onClick=${() => setTheme(t => t === 'light' ? 'dark' : 'light')}>
                ${theme === 'light' ? 'üåô Dark' : '‚òÄÔ∏è Light'}
              </button>
            </div>
          </div>

          <div class="responsive-controls">
            <label>Container size:</label>
            ${PRESETS.map(p => html`
              <button
                key=${p.label}
                class=${`preset-btn ${containerWidth === (p.isPercent ? 100 : p.width) ? 'preset-btn--active' : ''}`}
                onClick=${() => setContainerWidth(p.isPercent ? 100 : p.width)}
              >
                ${p.label} ${!p.isPercent ? `(${p.width}px)` : ''}
              </button>
            `)}
            <input
              type="range"
              class="size-slider"
              min="280"
              max="1200"
              value=${sliderValue}
              onInput=${e => setContainerWidth(Number(e.target.value))}
            />
            <span class="size-label">${sizeLabel}</span>
          </div>

          <div class="editor-wrapper" style=${{ width: widthStyle }}>
            <${JsonEditor}
              value=${jsonValue}
              onChange=${handleChange}
              mode=${mode}
              onModeChange=${setMode}
              schema=${parsedSchema}
              onValidate=${handleValidate}
              theme=${theme}
              height=${500}
              searchable=${true}
              sortable=${true}
              indentation=${2}
              lineNumbers=${true}
              bracketMatching=${true}
            />
          </div>

          ${validationErrors.length > 0 && html`
            <details class="validation-panel" open>
              <summary>${validationErrors.length} validation ${validationErrors.length === 1 ? 'issue' : 'issues'}</summary>
              ${validationErrors.map((err, i) => html`
                <div key=${i} class="validation-item">
                  <span class="v-path">${err.path}</span>
                  <span class="v-msg">${err.message}</span>
                </div>
              `)}
            </details>
          `}

          <details class="schema-panel">
            <summary>JSON Schema (for validation)</summary>
            <textarea
              class="schema-textarea"
              value=${schema}
              onInput=${e => setSchema(e.target.value)}
              spellcheck=${false}
            />
          </details>
        </div>
      `;
    }

    createRoot(document.getElementById('app')).render(html`<${App} />`);
  </script>
</body>
</html>
